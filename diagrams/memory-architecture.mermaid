graph TB
    subgraph "Memory Input Sources"
        UI[ğŸ‘¤ User Input<br/>Message + Session ID<br/>User Identifier]
        CT[ğŸ•’ Current Time<br/>Timestamp<br/>Context Window]
    end

    subgraph "Session Memory Management"
        SM[ğŸ’­ Session Memory<br/>Current Conversation]

        subgraph "Session Storage"
            SC[ğŸ“ Session Cache<br/>Real-time Context]
            SH[ğŸ“š Session History<br/>Full Conversation]
            SW[ğŸªŸ Session Window<br/>Recent Messages]
        end
    end

    subgraph "User Memory Management"
        UM[ğŸ‘¤ User Memory<br/>Cross-Session History]

        subgraph "User Storage"
            UP[ğŸ“‹ User Profile<br/>Persistent Context]
            UH[ğŸ—‚ï¸ User History<br/>All Conversations]
            UO[ğŸ“¦ User Orders<br/>Business Context]
        end
    end

    subgraph "Semantic Memory Management"
        SEM[ğŸ” Semantic Memory<br/>Vector Embeddings]

        subgraph "Vector Storage"
            VE[ğŸ¯ Vector Embeddings<br/>CLIP + OpenAI]
            SS[ğŸ” Semantic Search<br/>Similar Conversations]
            CR[ğŸ”— Contextual Retrieval<br/>Relevant History]
        end
    end

    subgraph "Business Data Integration"
        BD[ğŸ—„ï¸ Business Data<br/>PostgreSQL Integration]

        subgraph "Data Sources"
            CD[ğŸ‘¥ Customer Data<br/>Profile & Contact]
            OD[ğŸ“¦ Order Data<br/>Purchase History]
            SD[ğŸšš Shipping Data<br/>Fulfillment Status]
            TD[ğŸ« Ticket Data<br/>Support History]
        end
    end

    subgraph "Memory Processing Engine"
        MPE[âš™ï¸ Memory Processor<br/>Context Assembly]

        subgraph "Processing Steps"
            MC[ğŸ”„ Memory Consolidation<br/>Combine Sources]
            CF[ğŸ“Š Context Filtering<br/>Relevance Scoring]
            CP[ğŸ¯ Context Prioritization<br/>Importance Ranking]
        end
    end

    subgraph "AI Context Generation"
        ACG[ğŸ§  AI Context<br/>LLM Ready Format]

        subgraph "Context Components"
            CC[ğŸ’¬ Conversation Context<br/>Recent Messages]
            BC[ğŸ“Š Business Context<br/>Customer Data]
            HC[ğŸ“š Historical Context<br/>Past Interactions]
            SC2[ğŸ” Semantic Context<br/>Related Conversations]
        end
    end

    subgraph "Security & Authorization"
        SA[ğŸ” Security Layer<br/>Access Control]

        subgraph "Security Rules"
            RC[ğŸ‘¤ Role Check<br/>Customer vs Agent]
            DP[ğŸ›¡ï¸ Data Permissions<br/>Own vs Others Data]
            AL[ğŸ“ Access Logging<br/>Audit Trail]
        end
    end

    %% Input Flow
    UI --> SM
    UI --> UM
    CT --> MPE

    %% Session Memory Flow
    SM --> SC
    SM --> SH
    SM --> SW

    %% User Memory Flow
    UM --> UP
    UM --> UH
    UM --> UO

    %% Semantic Memory Flow
    SEM --> VE
    SEM --> SS
    SEM --> CR

    %% Business Data Flow
    BD --> CD
    BD --> OD
    BD --> SD
    BD --> TD

    %% Processing Flow
    SC --> MPE
    SH --> MPE
    UP --> MPE
    UH --> MPE
    VE --> MPE
    CD --> MPE
    OD --> MPE

    MPE --> MC
    MC --> CF
    CF --> CP

    %% Context Generation
    CP --> ACG
    ACG --> CC
    ACG --> BC
    ACG --> HC
    ACG --> SC2

    %% Security Integration
    SA --> RC
    SA --> DP
    SA --> AL
    RC --> ACG
    DP --> BD
    AL --> MPE

    %% Memory Persistence
    ACG -->|Store| SH
    ACG -->|Update| UP
    ACG -->|Index| VE

    %% Memory Types and Characteristics
    subgraph "Memory Characteristics"
        MT1[ğŸ”„ Session Memory<br/>â€¢ Temporary<br/>â€¢ High Priority<br/>â€¢ Conversation Flow]
        MT2[ğŸ‘¤ User Memory<br/>â€¢ Persistent<br/>â€¢ Personal Context<br/>â€¢ Cross-Session]
        MT3[ğŸ” Semantic Memory<br/>â€¢ Searchable<br/>â€¢ Pattern Matching<br/>â€¢ Knowledge Base]
        MT4[ğŸ“Š Business Memory<br/>â€¢ Authoritative<br/>â€¢ Real-time<br/>â€¢ Transaction Data]
    end

    %% Styling
    classDef session fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef user fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef semantic fill:#e8f5e8,stroke:#388e3c,stroke-width:2px
    classDef business fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef processing fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef context fill:#e0f2f1,stroke:#00796b,stroke-width:2px
    classDef security fill:#ffebee,stroke:#d32f2f,stroke-width:2px
    classDef memory fill:#f9fbe7,stroke:#689f38,stroke-width:2px

    class SM,SC,SH,SW session
    class UM,UP,UH,UO user
    class SEM,VE,SS,CR semantic
    class BD,CD,OD,SD,TD business
    class MPE,MC,CF,CP processing
    class ACG,CC,BC,HC,SC2 context
    class SA,RC,DP,AL security
    class MT1,MT2,MT3,MT4 memory