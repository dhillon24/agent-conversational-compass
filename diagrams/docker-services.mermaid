graph TB
    subgraph "Docker Host Environment"
        subgraph "Database Tier"
            PG[ğŸ˜ PostgreSQL Database<br/>ğŸ”§ Service: postgres<br/>ğŸ“Š Business Data<br/>ğŸŒ Port: 5432<br/>ğŸ’¾ Volume: pg_data]
            QD[ğŸ” Qdrant Vector DB<br/>ğŸ”§ Service: qdrant<br/>ğŸ’­ Conversation Memory<br/>ğŸŒ Port: 6333<br/>ğŸ’¾ Volume: qdrant_data]
        end

        subgraph "Backend Services Tier"
            MCP[ğŸ”§ MCP Server<br/>ğŸ”§ Service: mcp_server<br/>ğŸ› ï¸ Database Tools<br/>ğŸŒ Port: 8001<br/>ğŸ“¡ Health: /health]

            BE[ğŸš€ FastAPI Backend<br/>ğŸ”§ Service: backend<br/>ğŸ¯ Main API Logic<br/>ğŸŒ Port: 8000<br/>ğŸ“¡ Health: /health]

            WK[âš™ï¸ Worker Service<br/>ğŸ”§ Service: worker<br/>ğŸ”„ Background Tasks<br/>ğŸŒ Port: 8002<br/>ğŸ“¡ Health: /health]
        end

        subgraph "Frontend Tier"
            FE[âš›ï¸ React Frontend<br/>ğŸ”§ Service: frontend<br/>ğŸ¨ User Interface<br/>ğŸŒ Port: 5173<br/>ğŸ“¦ Built with Vite]
        end
    end

    subgraph "External Services"
        OAI[ğŸ§  OpenAI API<br/>GPT-4o-mini<br/>ğŸ”‘ API Key Required]
        DNS[ğŸŒ External DNS<br/>Domain Resolution]
    end

    subgraph "Development Tools"
        DK[ğŸ³ Docker Engine<br/>Container Runtime]
        DC[ğŸ™ Docker Compose<br/>Service Orchestration]
        VL[ğŸ’¾ Docker Volumes<br/>Persistent Storage]
    end

    %% Service Dependencies
    BE --> PG
    BE --> QD
    BE --> MCP
    BE --> WK
    BE --> OAI

    MCP --> PG

    FE --> BE

    %% Docker Infrastructure
    DK --> PG
    DK --> QD
    DK --> MCP
    DK --> BE
    DK --> WK
    DK --> FE

    DC --> DK
    VL --> PG
    VL --> QD

    %% External Dependencies
    BE --> OAI
    FE --> DNS

    %% Service Details
    subgraph "Service Configuration Details"
        subgraph "PostgreSQL Configuration"
            PG_ENV[ğŸ“ Environment:<br/>POSTGRES_DB=customer_service<br/>POSTGRES_USER=cs_user<br/>POSTGRES_PASSWORD=cs_password]
            PG_VOL[ğŸ’¾ Volume Mounts:<br/>/var/lib/postgresql/data<br/>Persistent database storage]
            PG_NET[ğŸŒ Networks:<br/>app-network<br/>Internal service discovery]
        end

        subgraph "Qdrant Configuration"
            QD_ENV[ğŸ“ Environment:<br/>QDRANT__SERVICE__HTTP_PORT=6333<br/>Vector database config]
            QD_VOL[ğŸ’¾ Volume Mounts:<br/>/qdrant/storage<br/>Vector data persistence]
            QD_NET[ğŸŒ Networks:<br/>app-network<br/>REST API access]
        end

        subgraph "MCP Server Configuration"
            MCP_ENV[ğŸ“ Environment:<br/>DATABASE_URL=postgresql://...<br/>ENVIRONMENT=development]
            MCP_DEP[ğŸ”— Dependencies:<br/>postgres (healthy)<br/>Database connection required]
            MCP_VOL[ğŸ“ Code Mount:<br/>./mcp_server:/app<br/>Development mode]
        end

        subgraph "Backend Configuration"
            BE_ENV[ğŸ“ Environment:<br/>OPENAI_API_KEY=sk-...<br/>QDRANT_URL=http://qdrant:6333<br/>MCP_SERVER_URL=http://mcp_server:8001]
            BE_DEP[ğŸ”— Dependencies:<br/>qdrant (healthy)<br/>mcp_server (healthy)<br/>postgres (healthy)]
            BE_VOL[ğŸ“ Code Mount:<br/>./backend:/app<br/>Development mode]
        end

        subgraph "Worker Configuration"
            WK_ENV[ğŸ“ Environment:<br/>CELERY_BROKER_URL=redis://...<br/>Background task config]
            WK_DEP[ğŸ”— Dependencies:<br/>backend (healthy)<br/>Shared dependencies]
            WK_VOL[ğŸ“ Code Mount:<br/>./worker:/app<br/>Development mode]
        end

        subgraph "Frontend Configuration"
            FE_ENV[ğŸ“ Environment:<br/>VITE_API_BASE_URL=http://localhost:8000<br/>Backend API endpoint]
            FE_DEP[ğŸ”— Dependencies:<br/>backend (healthy)<br/>API availability required]
            FE_VOL[ğŸ“ Code Mount:<br/>./frontend:/app<br/>Development mode with HMR]
        end
    end

    %% Health Checks
    subgraph "Health Monitoring"
        HC[ğŸ¥ Health Checks<br/>Docker Compose]

        HC --> PG : "pg_isready -U cs_user"
        HC --> QD : "curl http://localhost:6333/health"
        HC --> MCP : "curl http://localhost:8001/health"
        HC --> BE : "curl http://localhost:8000/health"
        HC --> WK : "curl http://localhost:8002/health"
        HC --> FE : "curl http://localhost:5173"
    end

    %% Data Flow Paths
    subgraph "Data Flow Patterns"
        DF1[ğŸ“Š Customer Query Flow<br/>Frontend â†’ Backend â†’ MCP â†’ PostgreSQL]
        DF2[ğŸ’­ Memory Storage Flow<br/>Backend â†’ Qdrant â†’ Vector Storage]
        DF3[ğŸ¤– AI Processing Flow<br/>Backend â†’ LangGraph â†’ OpenAI â†’ Response]
        DF4[ğŸ”„ Background Task Flow<br/>Backend â†’ Worker â†’ Async Processing]
    end

    %% Network Configuration
    subgraph "Docker Networks"
        NET[ğŸŒ app-network<br/>Bridge Network<br/>Internal Service Discovery]

        NET --> PG : "postgres:5432"
        NET --> QD : "qdrant:6333"
        NET --> MCP : "mcp_server:8001"
        NET --> BE : "backend:8000"
        NET --> WK : "worker:8002"
        NET --> FE : "frontend:5173"
    end

    %% Port Mappings
    subgraph "Port Mappings"
        PORTS[ğŸŒ Host Port Mappings<br/>localhost:5173 â†’ frontend:5173<br/>localhost:8000 â†’ backend:8000<br/>localhost:8001 â†’ mcp_server:8001<br/>localhost:8002 â†’ worker:8002<br/>localhost:6333 â†’ qdrant:6333<br/>localhost:5432 â†’ postgres:5432]
    end

    %% Styling
    classDef database fill:#fff3e0,stroke:#ef6c00,stroke-width:3px
    classDef backend fill:#f3e5f5,stroke:#7b1fa2,stroke-width:3px
    classDef frontend fill:#e1f5fe,stroke:#0277bd,stroke-width:3px
    classDef external fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef infrastructure fill:#f1f8e9,stroke:#558b2f,stroke-width:2px
    classDef config fill:#fafafa,stroke:#616161,stroke-width:1px
    classDef network fill:#e8eaf6,stroke:#3f51b5,stroke-width:2px

    class PG,QD database
    class MCP,BE,WK backend
    class FE frontend
    class OAI,DNS external
    class DK,DC,VL infrastructure
    class PG_ENV,PG_VOL,PG_NET,QD_ENV,QD_VOL,QD_NET,MCP_ENV,MCP_DEP,MCP_VOL,BE_ENV,BE_DEP,BE_VOL,WK_ENV,WK_DEP,WK_VOL,FE_ENV,FE_DEP,FE_VOL config
    class NET,PORTS network